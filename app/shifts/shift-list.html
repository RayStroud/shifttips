<div ng-controller="ShiftListController as ctrl">
	<h1>Shifts</h1>
	<div class="error message-box" ng-show="ctrl.error">{{ctrl.error}}</div>
	<div ng-hide="ctrl.error">
		<div ng-controller="FiltersController as filtersCtrl">
			<form class="filter-form" method="get" action="#">
				<div class="filter-group" id="filter-view-style">
					<div class="filter-group-wrap">
						<div class="filter-group-header">View Style</div>
						<div class="filter-group-body">
							<a class="link-button" href="#/shifts/list"><span class="fa fa-fw fa-table"></span></a>
							<a class="link-button button-inverse" href="#/shifts/grid"><span class="fa fa-fw fa-th-large"></span></a>
						</div>
					</div>
				</div>
				<div class="filter-group" id="filter-visible">
					<div class="filter-group-wrap">
						<div class="filter-group-header">Filters</div>
						<div class="filter-group-body">
							<div ng-hide="filtersCtrl.filters.visible" class="link-button button-inverse" ng-click="filtersCtrl.setFilter('visible',true)"><span class="fa fa-fw fa-eye"></span></div>
							<div ng-show="filtersCtrl.filters.visible" class="link-button" ng-click="filtersCtrl.setFilter('visible',false)"><span class="fa fa-fw fa-eye-slash"></span></div>
							<div class="link-button button-inverse" ng-click="filtersCtrl.clear()"><span class="fa fa-fw fa-eraser"></span></div>
						</div>
					</div>
				</div>
				<div ng-show="filtersCtrl.filters.visible" class="filter-group" id="filter-date-range">
					<div class="filter-group-wrap">
						<div class="filter-group-header">Date Range</div>
						<div class="filter-group-body">
							<input type="date" name="from" placeholder="yyyy-mm-dd" ng-model="filtersCtrl.filters.from" ng-change="filtersCtrl.updateFilters(); ctrl.updateSummary()"/>
							<input type="date" name="to" placeholder="yyyy-mm-dd" ng-model="filtersCtrl.filters.to" ng-change="filtersCtrl.updateFilters(); ctrl.updateSummary()"/>
						</div>
					</div>
				</div>
				<div ng-show="filtersCtrl.filters.visible" class="filter-group" id="filter-lunch-dinner">
					<div class="filter-group-wrap">
						<div class="filter-group-header">Lunch / Dinner</div>
						<div class="filter-group-body">
							<input type="checkbox" id="lun-check" name="lun" ng-checked="filtersCtrl.filters.lun">
							<label ng-click="filtersCtrl.toggleLD('lun'); ctrl.updateSummary();">L</label>
							<input type="checkbox" id="din-check" name="din" ng-checked="filtersCtrl.filters.din">
							<label ng-click="filtersCtrl.toggleLD('din'); ctrl.updateSummary();">D</label>
						</div>
					</div>
				</div>
				<div ng-show="filtersCtrl.filters.visible" class="filter-group" id="filter-day-of-week">
					<div class="filter-group-wrap">
						<div class="filter-group-header">Day of Week</div>
						<div class="filter-group-body">
							<input type="checkbox" id="mon-check" name="mon" ng-checked="filtersCtrl.filters.mon">
							<label ng-click="filtersCtrl.toggleDay('mon'); ctrl.updateSummary();">Mon</label>
							<input type="checkbox" id="tue-check" name="tue" ng-checked="filtersCtrl.filters.tue">
							<label ng-click="filtersCtrl.toggleDay('tue'); ctrl.updateSummary();">Tue</label>
							<input type="checkbox" id="wed-check" name="wed" ng-checked="filtersCtrl.filters.wed">
							<label ng-click="filtersCtrl.toggleDay('wed'); ctrl.updateSummary();">Wed</label>
							<input type="checkbox" id="thu-check" name="thu" ng-checked="filtersCtrl.filters.thu">
							<label ng-click="filtersCtrl.toggleDay('thu'); ctrl.updateSummary();">Thu</label>
							<input type="checkbox" id="fri-check" name="fri" ng-checked="filtersCtrl.filters.fri">
							<label ng-click="filtersCtrl.toggleDay('fri'); ctrl.updateSummary();">Fri</label>
							<input type="checkbox" id="sat-check" name="sat" ng-checked="filtersCtrl.filters.sat">
							<label ng-click="filtersCtrl.toggleDay('sat'); ctrl.updateSummary();">Sat</label>
							<input type="checkbox" id="sun-check" name="sun" ng-checked="filtersCtrl.filters.sun">
							<label ng-click="filtersCtrl.toggleDay('sun'); ctrl.updateSummary();">Sun</label>
						</div>
					</div>
				</div>
			</form>
			<h3 class="filter-message">
				Viewing {{filteredShifts.length}} <span class="{{filtersCtrl.filters.lunchDinner ? 'filter-bold' : ''}}">{{filtersCtrl.filters.lunchDinner == 'L' ? 'Lunch' : ''}}{{filtersCtrl.filters.lunchDinner == 'D' ? 'Dinner' : ''}}</span> shifts on <span ng-if="filtersCtrl.filters.days"><span class="filter-bold" ng-if="filtersCtrl.filters.mon">Mon</span> <span class="filter-bold" ng-if="filtersCtrl.filters.tue">Tue</span> <span class="filter-bold" ng-if="filtersCtrl.filters.wed">Wed</span> <span class="filter-bold" ng-if="filtersCtrl.filters.thu">Thu</span> <span class="filter-bold" ng-if="filtersCtrl.filters.fri">Fri</span> <span class="filter-bold" ng-if="filtersCtrl.filters.sat">Sat</span> <span class="filter-bold" ng-if="filtersCtrl.filters.sun">Sun</span></span><span ng-if="!filtersCtrl.filters.days">any day</span> from <span class="{{filtersCtrl.filters.from ? 'filter-bold' : ''}}">{{filtersCtrl.filters.from ? (filtersCtrl.filters.from | date) : 'any date'}}</span> to <span class="{{filtersCtrl.filters.to ? 'filter-bold' : ''}}">{{filtersCtrl.filters.to ? (filtersCtrl.filters.to | date) : 'any date'}}</span>
			</h3>
			<div ng-show="filteredShifts.length < 1">
				No shifts found
			</div>
			<div ng-hide="filteredShifts.length < 1 || ctrl.error">
				<div class="mobile-table">
					<table class="summary-table">
						<thead ng-class="{'sort-reverse':filtersCtrl.filters.listReverse}">
							<tr class="header">
								<th ng-if="filtersCtrl.prefs.list.lunchDinner" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort(filtersCtrl.listSortValues.lunchDinner)}" 
									ng-click="filtersCtrl.changeListSort(filtersCtrl.listSortValues.lunchDinner)">L/D</th>
								<th ng-if="filtersCtrl.prefs.list.dayOfWeek" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort(filtersCtrl.listSortValues.dayOfWeek)}" 
									ng-click="filtersCtrl.changeListSort(filtersCtrl.listSortValues.dayOfWeek)">Day</th>
								<th class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort(filtersCtrl.listSortValues.date)}" 
									ng-click="filtersCtrl.changeListSort(filtersCtrl.listSortValues.date)">Date</th>
								<th ng-if="filtersCtrl.prefs.list.startTime" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('startTime')}" 
									ng-click="filtersCtrl.changeListSort('startTime')">Start</th>
								<th ng-if="filtersCtrl.prefs.list.endTime" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('endTime')}" 
									ng-click="filtersCtrl.changeListSort('endTime')">End</th>
								<th ng-if="filtersCtrl.prefs.list.hours" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('hours')}" 
									ng-click="filtersCtrl.changeListSort('hours')">Hours</th>
								<th ng-if="filtersCtrl.prefs.list.earnedWage" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('earnedWage')}" 
									ng-click="filtersCtrl.changeListSort('earnedWage')">Wage</th>
								<th ng-if="filtersCtrl.prefs.list.earnedTips" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('earnedTips')}" 
									ng-click="filtersCtrl.changeListSort('earnedTips')">Tips</th>
								<th ng-if="filtersCtrl.prefs.list.earnedTotal" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('earnedTotal')}" 
									ng-click="filtersCtrl.changeListSort('earnedTotal')">Earned</th>
								<th ng-if="filtersCtrl.prefs.list.sales" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('sales')}" 
									ng-click="filtersCtrl.changeListSort('sales')">Sales</th>
								<th ng-if="filtersCtrl.prefs.list.tipout" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('tipout')}" 
									ng-click="filtersCtrl.changeListSort('tipout')">T/O</th>
								<th ng-if="filtersCtrl.prefs.list.transfers" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('transfers')}" 
									ng-click="filtersCtrl.changeListSort('transfers')">Tsfr</th>
								<th ng-if="filtersCtrl.prefs.list.covers" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('covers')}" 
									ng-click="filtersCtrl.changeListSort('covers')">Cov</th>
								<th ng-if="filtersCtrl.prefs.list.campHours" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('campHours')}" 
									ng-click="filtersCtrl.changeListSort('campHours')">Camp</th>
								<th ng-if="filtersCtrl.prefs.list.salesPerHour" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('salesPerHour')}" 
									ng-click="filtersCtrl.changeListSort('salesPerHour')">Sales/h</th>
								<th ng-if="filtersCtrl.prefs.list.salesPerCover" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('salesPerCover')}" 
									ng-click="filtersCtrl.changeListSort('salesPerCover')">Sales/cov</th>
								<th ng-if="filtersCtrl.prefs.list.tipsPercent" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('tipsPercent')}" 
									ng-click="filtersCtrl.changeListSort('tipsPercent')">%Tips</th>
								<th ng-if="filtersCtrl.prefs.list.tipoutPercent" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('tipoutPercent')}" 
									ng-click="filtersCtrl.changeListSort('tipoutPercent')">%T/O</th>
								<th ng-if="filtersCtrl.prefs.list.tipsVsWage" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('tipsVsWage')}" 
									ng-click="filtersCtrl.changeListSort('tipsVsWage')">%TvsW</th>
								<th ng-if="filtersCtrl.prefs.list.hourly" class="sortable" ng-class="{'sort-field':filtersCtrl.isListSort('hourly')}" 
									ng-click="filtersCtrl.changeListSort('hourly')">Earn/h</th>
							</tr>
						</thead>
						<tr class="clickable-row {{shift.dayOfWeek | lowercase}}-row {{shift.lunchDinner | lowercase}}-row" ng-repeat="shift in filteredShifts = (ctrl.shifts | isValidShift:filtersCtrl.filters | orderBy:filtersCtrl.filters.listSort:filtersCtrl.filters.listReverse ) track by $index" ng-class-even="'alt'" ng-click="ctrl.viewShift(shift.id)">
							<td ng-if="filtersCtrl.prefs.list.lunchDinner" class="ld-cell">{{shift.lunchDinner | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.dayOfWeek" class="day-cell">{{shift.dayOfWeek | placeholder:'-'}}</td>
							<td>{{shift.date | date:'MMM dd, yyyy' | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.startTime">{{shift.startTime | timeToDate | date:'h:mma' | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.endTime">{{shift.endTime | timeToDate | date:'h:mma' | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.hours">{{shift.hours | number:2 | placeholder:'-':undefined:'h'}}</td>
							<td ng-if="filtersCtrl.prefs.list.earnedWage">{{shift.earnedWage | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.earnedTips">{{shift.earnedTips | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.earnedTotal">{{shift.earnedTotal | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.sales">{{shift.sales | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipout">{{shift.tipout | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.transfers">{{shift.transfers | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.covers">{{shift.covers | number:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.campHours">{{shift.campHours | number:2 | placeholder:'-':undefined:'h'}}</td>
							<td ng-if="filtersCtrl.prefs.list.salesPerHour">{{shift.salesPerHour | currency:undefined:0 | placeholder:'-':undefined:'/h'}}</td>
							<td ng-if="filtersCtrl.prefs.list.salesPerCover">{{shift.salesPerCover | currency:undefined:0 | placeholder:'-':undefined:'/cov'}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipsPercent">{{shift.tipsPercent | number:1 | placeholder:'-':undefined:'%'}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipoutPercent">{{shift.tipoutPercent | number:1 | placeholder:'-':undefined:'%'}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipsVsWage">{{shift.tipsVsWage | number:0 | placeholder:'-':undefined:'%'}}</td>
							<td ng-if="filtersCtrl.prefs.list.hourly">{{shift.hourly | currency | placeholder:'-':undefined:'/h'}}</td>
						</tr>
						<tr class="summary">
							<td ng-if="filtersCtrl.prefs.list.lunchDinner"></td>
							<td ng-if="filtersCtrl.prefs.list.dayOfWeek"></td>
							<td><i>average</i></td>
							<td ng-if="filtersCtrl.prefs.list.startTime"></td>
							<td ng-if="filtersCtrl.prefs.list.endTime"></td>
							<td ng-if="filtersCtrl.prefs.list.hours">{{ctrl.summary.avgHours | number:2 | placeholder:'-':undefined:'h'}}</td>
							<td ng-if="filtersCtrl.prefs.list.earnedWage">{{ctrl.summary.avgWage | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.earnedTips">{{ctrl.summary.avgTips | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.earnedTotal">{{ctrl.summary.avgEarned | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.sales">{{ctrl.summary.avgSales | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipout">{{ctrl.summary.avgTipout | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.transfers">{{ctrl.summary.avgTransfers | currency:undefined:0 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.covers">{{ctrl.summary.avgCovers | number:1 | placeholder:'-'}}</td>
							<td ng-if="filtersCtrl.prefs.list.campHours">{{ctrl.summary.avgCampHours | number:2 | placeholder:'-':undefined:'h'}}</td>
							<td ng-if="filtersCtrl.prefs.list.salesPerHour">{{ctrl.summary.salesPerHour | currency:undefined:0 | placeholder:'-':undefined:'/h'}}</td>
							<td ng-if="filtersCtrl.prefs.list.salesPerCover">{{ctrl.summary.salesPerCover | currency:undefined:0 | placeholder:'-':undefined:'/cov'}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipsPercent">{{ctrl.summary.tipsPercent | number:1 | placeholder:'-':undefined:'%'}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipoutPercent">{{ctrl.summary.tipoutPercent | number:1 | placeholder:'-':undefined:'%'}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipsVsWage">{{ctrl.summary.tipsVsWage | number:0 | placeholder:'-':undefined:'%'}}</td>
							<td ng-if="filtersCtrl.prefs.list.hourly">{{ctrl.summary.hourly | currency | placeholder:'-':undefined:'/h'}}</td>
						</tr>
						<tr class="summary">
							<td ng-if="filtersCtrl.prefs.list.lunchDinner" class="tot-cell"></td>
							<td ng-if="filtersCtrl.prefs.list.dayOfWeek" class="tot-cell"></td>
							<td class="tot-cell"><i>{{ctrl.summary.count}} total</i></td>
							<td ng-if="filtersCtrl.prefs.list.startTime" class="tot-cell"></td>
							<td ng-if="filtersCtrl.prefs.list.endTime" class="tot-cell"></td>
							<td ng-if="filtersCtrl.prefs.list.hours" class="tot-cell">{{ctrl.summary.totHours | number:0}}h</td>
							<td ng-if="filtersCtrl.prefs.list.earnedWage" class="tot-cell">{{ctrl.summary.totWage | currency:undefined:0}}</td>
							<td ng-if="filtersCtrl.prefs.list.earnedTips" class="tot-cell">{{ctrl.summary.totTips | currency:undefined:0}}</td>
							<td ng-if="filtersCtrl.prefs.list.earnedTotal" class="tot-cell">{{ctrl.summary.totEarned | currency:undefined:0}}</td>
							<td ng-if="filtersCtrl.prefs.list.sales" class="tot-cell">{{ctrl.summary.totSales | currency:undefined:0}}</td>
							<td ng-if="filtersCtrl.prefs.list.tipout" class="tot-cell">{{ctrl.summary.totTipout | currency:undefined:0}}</td>
							<td ng-if="filtersCtrl.prefs.list.transfers" class="tot-cell">{{ctrl.summary.totTransfers | currency:undefined:0}}</td>
							<td ng-if="filtersCtrl.prefs.list.covers" class="tot-cell">{{ctrl.summary.totCovers | number:0}}</td>
							<td ng-if="filtersCtrl.prefs.list.campHours" class="tot-cell">{{ctrl.summary.totCampHours | number:2}}h</td>
							<td ng-if="filtersCtrl.prefs.list.salesPerHour" class="tot-cell"></td>
							<td ng-if="filtersCtrl.prefs.list.salesPerCover" class="tot-cell"></td>
							<td ng-if="filtersCtrl.prefs.list.tipsPercent" class="tot-cell"></td>
							<td ng-if="filtersCtrl.prefs.list.tipoutPercent" class="tot-cell"></td>
							<td ng-if="filtersCtrl.prefs.list.tipsVsWage" class="tot-cell"></td>
							<td ng-if="filtersCtrl.prefs.list.hourly" class="tot-cell"></td>
						</tr>
					</table>
						
				</div>
			</div>
		</div>
	</div>
</div>